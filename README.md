# NILA ¬∑ Admin Launcher for LINE

‡∏ä‡∏∏‡∏î‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‚ÄúNILA ¬∑ Admin‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE Official Account ‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà LIFF launcher, PR/PO workflow, PDF export, ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á quick form ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô

## üöÄ Getting Started

```bash
npm install
cp .env.example .env   # ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å .env ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
npm run start
```

> **Tip:** ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ `npm run dev` (‡∏°‡∏µ nodemon) ‡πÄ‡∏û‡∏∑‡πà‡∏≠ reload ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

## üîê Environment Variables

‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ (‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô repo ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß)

```env
BASE_URL=https://nila-admin.sorni.dev
SESSION_SECRET=<‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 32 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£>
MONGODB_URI=<MongoDB connection string>
LIFF_ID=<LIFF ID ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å LINE Developers>
```

‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÄ‡∏ä‡πà‡∏ô `LINE_CHANNEL_SECRET`, `LINE_CHANNEL_ACCESS_TOKEN`

## üÜî ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [LINE Developers Console](https://developers.line.biz/console/) ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á LIFF app (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó `Full` ‡∏´‡∏£‡∏∑‡∏≠ `Compact` ‡∏Å‡πá‡πÑ‡∏î‡πâ)
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF URL ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏µ‡πà `https://nila-admin.sorni.dev/liff-open-admin`
3. ‡∏ô‡∏≥ `LIFF ID` ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô `.env` (`LIFF_ID=...`)
4. ‡∏õ‡∏£‡∏±‡∏ö whitelist domain ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°
   - `https://nila-admin.sorni.dev`
   - `https://liff.line.me`

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ **Important URLs** ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°/‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô LINE OA

## üóÇÔ∏è Procurement Workflow Highlights

- **PR Dashboard** (`/admin/pr`) ‚Äì ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏Å‡∏£‡∏≠‡∏á/‡πÄ‡∏û‡∏à ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Draft ‚Üí Waiting Approval ‚Üí Approved/Rejected/Closed
- **PR Form** (`/admin/pr/new`) ‚Äì ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏° VAT, ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡∏∞ Submit for approval
- **Approve & Auto Create PO** (`POST /admin/pr/:id/approve`) ‚Äì ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á PO draft ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ú‡∏π‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **PO Dashboard / Form / Detail** ‚Äì ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Draft, Approved, Sent, Received, Cancelled), ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF, ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
- **Quick Forms ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE**  
  - `/line/forms/quick-pr` (‡∏™‡∏£‡πâ‡∏≤‡∏á PR ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô 1‚Äì2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)  
  - `/line/approve/pr/:id` (‡∏´‡∏ô‡πâ‡∏≤ Approve/Reject ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ ‡πÜ)

## üìÑ Seed Demo Data

‡∏™‡∏£‡πâ‡∏≤‡∏á vendor + PR + PO ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:

```bash
npm run seed:procurement
```

‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MongoDB ‡∏ï‡∏≤‡∏° `MONGODB_URI`, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ ‚ÄúNILA Procurement Demo‚Äù, PR ‡∏û‡∏£‡πâ‡∏≠‡∏° line items ‡πÅ‡∏•‡∏∞ PO draft ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ô

## üîç Postman / cURL

‡πÑ‡∏ü‡∏•‡πå `docs/nila-admin.postman_collection.json` ‡∏°‡∏µ request ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏ä‡πà‡∏ô

- Launch admin via LIFF wrapper
- Create PR / Approve PR / Create PO
- Download PO PDF

Import ‡πÄ‡∏Ç‡πâ‡∏≤ Postman ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `base_url`, `session_cookie`, `vendor_id`, `pr_id`, `po_id` ‡∏ï‡∏≤‡∏° environment ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

## üß© Flex Button Snippets

‡πÑ‡∏ü‡∏•‡πå `docs/flex-buttons.json` ‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex JSON ‡∏õ‡∏∏‡πà‡∏°

- `‡πÄ‡∏õ‡∏¥‡∏î PR` ‚Üí `https://liff.line.me/<LIFF_ID>?to=/admin/pr`
- `‡∏™‡∏£‡πâ‡∏≤‡∏á PO` ‚Üí `https://liff.line.me/<LIFF_ID>?to=/admin/po/new`
- `‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ PR` ‚Üí `https://liff.line.me/<LIFF_ID>?to=/line/approve/pr/{{PR_ID}}`

‡πÅ‡∏ó‡∏ô `<LIFF_ID>` ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô `.env` (‡∏î‡∏π‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö URL ‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß)

## üîó Important URLs (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô repo ‡∏ô‡∏µ‡πâ)

- `LIFF_BASE` ‚Äì https://liff.line.me/1657917536-LAUNCHER  
- `LIFF_PR` ‚Äì https://liff.line.me/1657917536-LAUNCHER?to=/admin/pr  
- `LIFF_PO_NEW` ‚Äì https://liff.line.me/1657917536-LAUNCHER?to=/admin/po/new

‡∏ô‡∏≥‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° OA, Flex Message, ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

## ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ SSL proxy (‡πÄ‡∏ä‡πà‡∏ô Cloudflare/ALB) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á `x-forwarded-proto=https`
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Session cookie domain ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö production domain (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö quick forms ‡∏ö‡∏ô LINE app (iOS/Android) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å flow
- [ ] ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏ö‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå production ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤ LIFF/BASE URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ workflow ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡πÅ‡∏à‡πâ‡∏á LINE OA ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥) ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å service ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô `project-root/src/services/procurement` ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
