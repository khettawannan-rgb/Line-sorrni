<!-- src/views/member_form.ejs -->
<%
  const isEdit = !!(m && m._id);
  const formAction = isEdit ? `/admin/members/${m._id}/edit` : '/admin/members/new';
%>

<section class="section-block">
  <header class="section-header">
    <div class="section-header__titles">
      <span class="section-pill">Organization</span>
      <h2><%= isEdit ? 'ปรับปรุงสมาชิก' : 'สร้างสมาชิกใหม่' %></h2>
      <p class="muted">กำหนดสิทธิ์และข้อมูลการผูก LINE สำหรับพนักงาน</p>
    </div>
  </header>

  <article class="panel card">
    <header class="panel__header">
      <div>
        <h3><%= isEdit ? 'รายละเอียดสมาชิก' : 'ข้อมูลสมาชิก' %></h3>
        <p class="muted">กรอกข้อมูลที่ต้องการและบันทึกเพื่อใช้งานในระบบ</p>
      </div>
    </header>

    <% if (error) { %>
      <div class="alert error"><%= error %></div>
    <% } %>

    <form class="form" action="<%= formAction %>" method="post">
    <div class="form-grid">
      <div class="field">
        <label>Company</label>
        <select name="companyId">
          <option value="">— ไม่ผูก —</option>
          <% (companies || []).forEach(c => { %>
            <option value="<%= c._id %>" <%= (m && String(m.companyId)===String(c._id) ? 'selected' : '') %>><%= c.name %></option>
          <% }) %>
        </select>
      </div>

      <div class="field">
        <label>LINE userId</label>
        <input type="text" name="lineUserId" value="<%= (m && m.lineUserId) || '' %>" required />
      </div>

      <div class="field">
        <label>Display Name</label>
        <input type="text" name="displayName" value="<%= (m && m.displayName) || '' %>" />
      </div>

      <div class="field">
        <label>Bind Code (สำหรับ Line Binding Wizard)</label>
        <input type="text" name="bindCode" value="<%= (m && m.bindCode) || '' %>" />
        <small class="help">ใช้รหัสนี้ให้พนักงานกรอกตอนเชื่อมบัญชี LINE</small>
      </div>

      <div class="field">
        <label>Role</label>
        <select name="role">
          <option value="member" <%= (m && m.role==='member' ? 'selected' : '') %> >member</option>
          <option value="admin"  <%= (m && m.role==='admin'  ? 'selected' : '') %> >admin</option>
        </select>
      </div>
    </div>

    <div class="form-row inline">
      <label class="checkbox">
        <input type="checkbox" name="active" <%= (m && m.active) ? 'checked' : '' %> />
        <span>Active</span>
      </label>
    </div>

      <div class="form-actions">
        <a class="btn ghost" href="/admin/members">Back</a>
        <button class="btn primary" type="submit"><%= isEdit ? 'Save' : 'Create' %></button>
      </div>
    </form>
  </article>
</section>
