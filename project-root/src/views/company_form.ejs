<!-- src/views/company_form.ejs -->
<%
  const isEdit = !!(company && company._id);
  const formAction = isEdit ? `/admin/companies/${company._id}/edit` : '/admin/companies/new';
%>

<section class="section-block">
  <header class="section-header">
    <div class="section-header__titles">
      <span class="section-pill">Organization</span>
      <h2><%= isEdit ? 'ปรับปรุงบริษัท' : 'เพิ่มบริษัทใหม่' %></h2>
      <p class="muted">ตั้งค่าโซนเวลาและเวลาส่งรายงานประจำวัน</p>
    </div>
  </header>

  <article class="panel card">
    <header class="panel__header">
      <div>
        <h3>ข้อมูลบริษัท</h3>
        <p class="muted">กรอกข้อมูลพื้นฐานและค่าอ้างอิงจากระบบต้นทาง</p>
      </div>
    </header>

    <% if (error) { %>
      <div class="alert error"><%= error %></div>
    <% } %>

    <form class="form" action="<%= formAction %>" method="post">
    <div class="form-grid">
      <div class="field">
        <label>Name</label>
        <input type="text" name="name" value="<%= (company && company.name) || '' %>" required />
      </div>

      <div class="field">
        <label>Timezone</label>
        <input type="text" name="timezone" value="<%= (company && company.timezone) || 'Asia/Bangkok' %>" />
      </div>

      <div class="field">
        <label>Daily Time (HH:mm)</label>
        <input type="time" name="dailyTime" value="<%= (company && company.dailyTime) || '09:00' %>" />
      </div>

      <div class="field">
        <label>Source Company IDs (External)</label>
        <textarea name="sourceCompanyIds" rows="3" placeholder="เช่น ID ที่มาจากไฟล์ Excel แยกบรรทัด"><%= (company && Array.isArray(company.sourceCompanyIds) ? company.sourceCompanyIds.join('\n') : '') %></textarea>
        <small class="muted">ใช้ ID จากคอลัมน์ companyId ใน Excel (หนึ่งบรรทัดต่อหนึ่งค่า)</small>
      </div>

      <div class="field">
        <label>Source Company Names</label>
        <textarea name="sourceCompanyNames" rows="3" placeholder="เช่น ชื่อบริษัทในไฟล์ Excel แยกบรรทัด"><%= (company && Array.isArray(company.sourceCompanyNames) ? company.sourceCompanyNames.join('\n') : '') %></textarea>
        <small class="muted">ใช้ชื่อตามที่ปรากฏในไฟล์ Excel เพื่อจับคู่ข้อมูล (หนึ่งบรรทัดต่อหนึ่งชื่อ)</small>
      </div>
    </div>

      <div class="form-actions">
        <a class="btn ghost" href="/admin/companies">Back</a>
        <button class="btn primary" type="submit"><%= isEdit ? 'Save' : 'Create' %></button>
      </div>
    </form>
  </article>
</section>
